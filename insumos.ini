[read]
sql =
  SELECT
    sum(coalesce(iea.saldo,0)) saldo
  , ip.CodItemProd
  , SUBSTRING(ip.CodItemProd, 1, 2) iniCod
  , ip.CodEspecie
  , ip.DescrItemDeProducao
  , ip.Complemento
  , ip.CodColecao
  , ip.DataDeAtualizacao
  , ip.UnidMedida
  FROM TAB_ItemDeProducao ip
  LEFT JOIN TAB_ItemDeEstoqueAlmoxarifado iea
    on iea.CodItemProd = ip.CodItemProd
       and iea.saldo > 0
  WHERE ip.CodItemProd NOT LIKE 'DV%'
    and ip.CodItemProd NOT LIKE 'PA%'
    and ip.CodItemProd NOT LIKE 'MD%'
    and ip.CodItemProd NOT LIKE 'MA0%'
    and ip.CodItemProd NOT LIKE 'TC%'
    and ip.CodTipoDeMaterial = 200
    and ip.NivelTopologico = 4
    and REPLACE(REPLACE(ip.DescrItemDeProducao, '-', ''), ' ', '') <> ''
    -- and ip.CodItemProd = 'CX00800'
  GROUP BY
    ip.CodItemProd
  , ip.CodEspecie
  , ip.DescrItemDeProducao
  , ip.Complemento
  , ip.CodColecao
  , ip.DataDeAtualizacao
  , ip.UnidMedida
  HAVING
    sum(iea.saldo) >= 100
    or datediff(d, max(ip.DataDeAtualizacao), '2016-06-01T00:00:00') < 0
  ORDER BY
    ip.CodItemProd;

[functions]
sequence={"function": "count", "break": "inicod"}

[variables]
tipoitem={"value": "9"}

[columns]
newcod=t,{"format": "%s%03d", "fields": ["inicod", "sequence"]}
coditemprod=t
saldo=n,{"format": "%.2f"}
datadeatualizacao=d,{"format": "%d/%m/%Y"}
descritemdeproducao=t
complemento=t
tipoitem=t
unidmedida=t
