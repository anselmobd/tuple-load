SELECT
  i.NIVEL_ESTRUTURA
, i.GRUPO_ESTRUTURA
, i.PESO_UNITARIO --PESO_AMOSTRA
, CASE
    WHEN r.ARTIGO = 1001 THEN 1
    WHEN r.ARTIGO IN (1002, 1003, 1004) THEN 2
    WHEN r.ARTIGO IN (1005, 1006, 1007, 1008) THEN 3
    WHEN r.ARTIGO = 1009 THEN 4
    ELSE 0
  END quant
, r.*
FROM BASI_010 i
JOIN BASI_030 r
  ON r.NIVEL_ESTRUTURA = i.NIVEL_ESTRUTURA
 AND r.REFERENCIA = i.GRUPO_ESTRUTURA
WHERE i.NIVEL_ESTRUTURA = 1
  AND i.PESO_UNITARIO <> 0
;

UPDATE BASI_010 upi
SET
  upi.PESO_UNITARIO = 0.06 * coalesce(
  (
	SELECT
	  CASE
	    WHEN r.ARTIGO = 1001 THEN 1
	    WHEN r.ARTIGO IN (1002, 1003, 1004) THEN 2
	    WHEN r.ARTIGO IN (1005, 1006, 1007, 1008) THEN 3
	    WHEN r.ARTIGO = 1009 THEN 4
	    ELSE 0
	  END
	FROM BASI_030 r
	WHERE r.NIVEL_ESTRUTURA = upi.NIVEL_ESTRUTURA
	  AND r.REFERENCIA = upi.GRUPO_ESTRUTURA
  ), 0)
WHERE upi.NIVEL_ESTRUTURA = 1
;

UPDATE BASI_010 upi
SET
  upi.PESO_UNITARIO = 0
WHERE upi.NIVEL_ESTRUTURA = 1
;

---

SELECT
  t.PESO_LIQUIDO
, t.*
FROM BASI_020 t
WHERE t.BASI030_NIVEL030 = 1
  AND t.BASI030_REFERENC = '00103'
;

UPDATE BASI_020 upt
SET
  upt.PESO_LIQUIDO = 0.06 * coalesce(
  (
	SELECT
	  CASE
	    WHEN r.ARTIGO = 1001 THEN 1
	    WHEN r.ARTIGO IN (1002, 1003, 1004) THEN 2
	    WHEN r.ARTIGO IN (1005, 1006, 1007, 1008) THEN 3
	    WHEN r.ARTIGO = 1009 THEN 4
	    ELSE 0
	  END
	FROM BASI_030 r
	WHERE r.NIVEL_ESTRUTURA = upt.BASI030_NIVEL030
	  AND r.REFERENCIA = upt.BASI030_REFERENC
  ), 0)
WHERE upt.BASI030_NIVEL030 = 1
;
