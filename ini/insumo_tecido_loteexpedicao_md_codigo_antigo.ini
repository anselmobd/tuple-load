[read]
master.db=csv
master.filename=_produto_loteexpedicao_referencias.sort.codigos.csv
master.select={"keys": ["REFERENCIA"]}

db=pccon
sql=
  SELECT distinct
    es.CodItemComponente coditemprod
  FROM TAB_Estrutura es
  JOIN TAB_ItemDeProducao ip on ip.CodItemProd = es.CodItemComponente
  WHERE es.coditemprodpai = 'MD'+?
    and es.CodItemComponente NOT LIKE 'PA%'
    and es.CodItemComponente NOT LIKE 'MD%'
    and
      ( ip.CodEspecie = 'MALHA'
      or ip.CodEspecie = 'MICROFIBRA'
      or ip.CodEspecie = 'TECIDO'
      )
    and REPLACE(REPLACE(ip.DescrItemDeProducao, '-', ''), ' ', '') <> ''

[variables]
versao={"value": "2"}

[functions]
inicod={"str":
  { "field": "coditemprod"
  , "method": "slice"
  , "args": ["","2"]
  }}

[columns]
versaoorder=t,{"format": "%s%s %s", "fields": ["inicod", "versao", "coditemprod"]}
coditemprod=t

[post_process]
external1={ "id": "pa", "script": "uniqtuples.py", "args": ["_insumo_tecido_loteexpedicao_codigo_antigo.est"] }
sort={ "field": "versaoorder", "options": ["unique"] }
external2={ "id": "codigos", "script": "insumo_codigos.py", "args": ["2"] }
