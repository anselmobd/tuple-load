[read]
master.db=csv
master.filename=_produto_loteexpedicao_referencias.sort.codigos.csv
master.select={"keys": ["PA", "REFERENCIA"]}
_master.first=10
master.skip=2

db=pccon
sql=
  SELECT
    ? GRUPO_ITEM
  , es.CodItemComponente cod
  , es.CodTamComponente tam
  , es.CodCorComponente cor
  , es.ConsumoUnitario CONSUMO
  , case WHEN ip.CodEspecie = 'MALHA' or ip.CodEspecie = 'MICROFIBRA' THEN
      2
    WHEN ip.CodEspecie = 'TECIDO' THEN
      1
    else
      0
    end QTDE_CAMADAS
  FROM TAB_Estrutura es
  JOIN TAB_ItemDeProducao ip on ip.CodItemProd = es.CodItemComponente
  WHERE es.coditemprodpai = 'PA'+?
  AND es.CodItemComponente not like 'DV%'
  AND ip.CodEspecie <> 'INSPECAO'
  order by
    es.Sequencial

[variables]
ALTERNATIVA_ITEM={"value": "1", "type": "n"}

[functions]
sequencia={"count": {"start": "10", "step": "10"}}
NIVEL_COMP={"translate":
  { "select": "NIVEL_ESTRUTURA"
  , "other_fields": [["grupo_comp", "REFERENCIA"],["sub_comp_tr", "TAM"],["item_comp_tr", "COR"]]
  , "type": "t"
  , "default": ["","","",""]
  , "from": "_componentes_tamanho_cor.tecidos.insumos.csv"
  , "where": [["CODITEMPROD", "cod"],["CODTAM", "#", "tam"],["CODCOR", "#", "cor"]]
  }}
sub_comp={"if_not_null": {"test_field": "tam", "field": "sub_comp_tr", "else_value": "000"}}
item_comp={"if_not_null": {"test_field": "cor", "field": "item_comp_tr", "else_value": "000000"}}

[columns]
GRUPO_ITEM=t
ALTERNATIVA_ITEM=n
SEQUENCIA=n
NIVEL_COMP=t
GRUPO_COMP=t
SUB_COMP=t
ITEM_COMP=t
QTDE_CAMADAS=n
CONSUMO=n,{"sqlformat": "%.5f"}
