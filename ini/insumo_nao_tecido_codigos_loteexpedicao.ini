[read]
master.db=csv
master.filename=_produto_loteexpedicao_referencias.sort.codigos.csv
master.select={"keys": ["REFERENCIA"]}
master.first=2
master.skip=2

db=pccon
sql=
  SELECT distinct
    es.CodItemComponente coditemprod
  FROM TAB_Estrutura es
  JOIN TAB_ItemDeProducao ip on ip.CodItemProd = es.CodItemComponente
  WHERE es.coditemprodpai = 'PA'+?
    and es.CodItemComponente NOT LIKE 'DV%'
    and es.CodItemComponente NOT LIKE 'PA%'
    and es.CodItemComponente NOT LIKE 'MD%'
    and ip.CodEspecie <> 'MALHA'
    and ip.CodEspecie <> 'TECIDO'
    -- and ip.CodItemProd NOT LIKE 'MA0%'
    -- and ip.CodItemProd NOT LIKE 'TC%'
    -- and ip.CodTipoDeMaterial = 200
    -- and ip.NivelTopologico = 4
    and REPLACE(REPLACE(ip.DescrItemDeProducao, '-', ''), ' ', '') <> ''

[functions]
iniCod={"str":
  { "field": "coditemprod"
  , "method": "slice"
  , "args": ["","2"]
  }}
sequence={"count": {"break": "inicod", "start": "2"}}

[variables]
nivel_estrutura={"value": "9"}

[columns]
nivel_estrutura=t
referencia=t,{"format": "%s%03d", "fields": ["inicod", "sequence"]}
CodItemProd=t

[post_process]
sort={ "field": "CodItemProd", "options": ["unique"] }
