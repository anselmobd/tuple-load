[read]
master.db=csv
master.filename=_produto_loteexpedicao_referencias.sort.codigos.csv
master.select={"keys": ["PA", "REFERENCIA"]}
master.first=2
master.skip=2

db=pccon
sql=
  SELECT
    '1' NIVEL_ITEM
  , ? GRUPO_ITEM
  , CodItemProdPai cod_pai_fabriq
  , Sequencial
  , CodCorPai
  , CodItemComponente
  , CodCorComponente
  FROM TAB_CombinacaoDeCor
  WHERE CodItemProdPai like 'PA%'
    --AND Sequencial='57812'
    --AND CodCorPai='BR'



  SELECT
    ? GRUPO_ITEM
  , tam.codtam
  , cor.CodCor
  , es.CodItemComponente cod
  , es.CodTamComponente tam
  , es.CodCorComponente cor
  , es.ConsumoUnitario CONSUMO
  , case WHEN ip.CodEspecie = 'MALHA' or ip.CodEspecie = 'MICROFIBRA' THEN
      2
    WHEN ip.CodEspecie = 'TECIDO' THEN
      1
    else
      0
    end QTDE_CAMADAS
  FROM TAB_Estrutura es
  JOIN TAB_ItemDeProducao ip on ip.CodItemProd = es.CodItemComponente
  LEFT JOIN TAB_TamanhoDoItemDeProducao tam
    on tam.CodItemProd = ip.CodItemProd
  LEFT JOIN TAB_CorDoItemDeProducao cor
    on cor.CodItemProd = ip.CodItemProd
  WHERE es.coditemprodpai = 'PA'+?
  AND es.CodItemComponente not like 'DV%'
  AND ip.CodEspecie <> 'INSPECAO'
  order by
    es.Sequencial

[variables]
ALTERNATIVA_ITEM={"value": "1", "type": "n"}

[functions]
sequencia={"count": {"start": "10", "step": "10"}}
NIVEL_COMP={"translate":
  { "select": "NIVEL_ESTRUTURA"
  , "other_fields": [["grupo_comp", "REFERENCIA"],["sub_comp_tr", "TAM"],["item_comp_tr", "COR"]]
  , "type": "t"
  , "default": ["","","",""]
  , "from": "_componentes_tamanho_cor.tecidos.insumos.csv"
  , "where": [["CODITEMPROD", "cod"],["CODTAM", "#", "tam"],["CODCOR", "#", "cor"]]
  }}
sub_comp={"if_not_null": {"test_field": "tam", "field": "sub_comp_tr", "else_value": "000"}}
item_comp={"if_not_null": {"test_field": "cor", "field": "item_comp_tr", "else_value": "000000"}}

[columns]
NIVEL_ITEM=t
GRUPO_ITEM=t
SUB_ITEM=t
ITEM_ITEM=t
ALTERNATIVA_ITEM=n
SEQUENCIA=t
SUB_COMP=t
ITEM_COMP=t
CONSUMO=n,{"sqlformat": "%.5f"}
