csv:

  fields:

    - CONTA_ESTOQUE:
        type: integer

  keys:
    - NIVEL_ESTRUTURA
    - REFERENCIA

sql:

  db: systextil

  key_count: |
    SELECT
      count(REFERENCIA)
    FROM BASI_030
    WHERE NIVEL_ESTRUTURA=:NIVEL_ESTRUTURA
      AND REFERENCIA=:REFERENCIA

  update: |
    UPDATE BASI_030 SET
      DESCR_REFERENCIA=:DESCRITEMDEPRODUCAO
    , UNIDADE_MEDIDA=:UNIDMEDIDA
    , CONTA_ESTOQUE=:CONTA_ESTOQUE
    , CODIGO_CONTABIL=:CODIGO_CONTABIL
    , COMPRADO_FABRIC=1
    , CLASSIFIC_FISCAL='0'
    WHERE NIVEL_ESTRUTURA=:NIVEL_ESTRUTURA
      AND REFERENCIA=:REFERENCIA

  insert: |
    INSERT INTO BASI_030
    ( NIVEL_ESTRUTURA
    , REFERENCIA
    , DESCR_REFERENCIA
    , UNIDADE_MEDIDA
    , CONTA_ESTOQUE
    , CODIGO_CONTABIL
    , COMPRADO_FABRIC
    , CLASSIFIC_FISCAL
    ) VALUES (
      :NIVEL_ESTRUTURA
    , :REFERENCIA
    , :DESCRITEMDEPRODUCAO
    , :UNIDMEDIDA
    , :CONTA_ESTOQUE
    , :CODIGO_CONTABIL -- identificador de carga = 99
    , 1
    , '0'
    )

  key_list: |
    SELECT
      NIVEL_ESTRUTURA
    , REFERENCIA
    FROM BASI_030
    WHERE CODIGO_CONTABIL=99

  delete: |
    DELETE FROM BASI_030
    WHERE NIVEL_ESTRUTURA=:NIVEL_ESTRUTURA
      AND REFERENCIA=:REFERENCIA
